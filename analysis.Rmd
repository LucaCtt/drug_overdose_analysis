---
title: "Drug Overdose Analysis"
output:
  html_notebook: default
  pdf_document: default
---

# Preparation

## Import packages

The first step of the analysis is to import the necessary packages:

```{r}
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("janitor")

library("dplyr")
library("ggplot2")
library("janitor")
```

- **dplyr**: provides a set of tools for efficiently manipulating datasets in R.
- **ggplot2**: for data visualization.
- **janitor**: for examining and cleaning dirty data.

## Import data set

The data set was taken from <https://www.kaggle.com/datasets/ruchi798/drug-overdose-deaths>,
which contains information regarding accidental drug related deaths in the U.S
state of Connecticut, in the years between 2012-2018.
The dataset contains a total of 5105 records, and 42 columns.

```{r}
data <- read.csv("drug_deaths.csv")
```

To check that the data was imported correctly, the `head` function can be used.
```{r}
head(data)
```
The first question that be asked about the dataset is what information it contains,
i.e. what are the columns of the dataset.
This question can be answered using the `names` function:

```{r}
names(data)
```
The dataset does not include a description for the columns, but most of them are
quite self-explaining. A few, however, deserve an explanation:

- *X*: a progressive integer to identify the record, starting from 0.
- *ID*: probably used to identify the person without revealing private information.
        It's composed by a two digit integer that represents the year of death,
        and a progressive four-digit integer that starts from zero.
        The two numbers are separated by a "-".
- *DateType*: specifies if the `date` should be interpreted as the date of death
               or the date when the death was reported.
- *Location*: location of death.
- *LocationifOther*: only used if `location=="other"`, to better specify the
                      location of death.
- *COD*: cause of death.
- *OtherSignificant*: other significant factors related to the death.


# Cleaning

## Names

The `janitor` package provides the `clean_names()` function which handles
problematic variable names, by doing the following cleaning steps:
- Return names with only lowercase letters, with _ as a separator
- Handles special characters and spaces
- Appends numbers to duplicated names
- Converts “%” to “percent” to retain meaning

```{r}
data <- data %>% clean_names()
```

The updated names can be seen using the `names` function:
```{r}
names(data)
```

## IDs

The dataset contains, for each record, two ids: `x` and `id`.
Neither of them are actually useful for this report, so they can be
removed without any consequence:
```{r}
data <- select(data,-x)
data <- select(data,-id)
```

## Dates

The dataset contains the date of death as a string, which consists in the 
actual date, plus the time of death. So it can be useful to convert the 
string to an actual date-time class.
However, looking at the data, it can be noticed that for most of the date-times,
the timepart is always equal to "12:00:00 AM". This can be verified:

```{r}
datetimes <- as.POSIXct(data$date, format="%m/%d/%Y %T")
times <- strftime(datetimes, format="%H:%M:%S")
print(unique(times))
```
All of the times of death are either "12:00:00 AM" or NA, so they can be eliminated
from the dataset.
This means that the significant part of the string is just the date:

```{r}
data$date <- as.Date(data$date, "%m/%d/%Y")
```

# Data exploration

An interesting information that can be easily discovered is the distribution
of the deaths over the years.

```{r}
years <- format(data$date,"%Y")
table(years)
```
We can also identify the number of records without a date of death (reported
or actual):
```{r}
sum(is.na(years))
```
